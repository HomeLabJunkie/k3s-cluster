name: Update Documentation
on:
  push:
    paths:
      - '.pre-commit-config.yaml'
      - 'roles/*/defaults/main.yaml'
      - 'roles/*/README.md.gotmpl'
  pull_request:
    paths:
      - '.pre-commit-config.yaml'
      - 'roles/*/defaults/main.yaml'
      - 'roles/*/README.md.gotmpl'
    types:
      - converted_to_draft
      - opened
      - reopened
      - synchronize
      - ready_for_review
concurrency:
  cancel-in-progress: true
  group: ${{ github.workflow }}-${{ github.ref }}
defaults:
  run:
    shell: bash
jobs:
  build:
    name: Build Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install package
        env:
          HELM_DOCS_URL: https://github.com/norwoodj/helm-docs/releases/download
          HELM_DOCS_VERSION: 1.14.2
        run: |
          sudo wget -qP /tmp $HELM_DOCS_URL/v${HELM_DOCS_VERSION}/helm-docs_${HELM_DOCS_VERSION}_Linux_x86_64.deb
          sudo apt-get -y install /tmp/helm-docs_${HELM_DOCS_VERSION}_Linux_x86_64.deb
      - name: Update documentation
        run: helm-docs
      - name: Update pull request
        run: |
          git config user.email '${{ github.actor_id }}+${{ github.actor }}@users.noreply.github.com'
          git config user.name '${{ github.actor }}'
          git commit -am 'Workflow: Update documentation'
          git push origin ${{ github.ref_name }}
permissions:
  contents: write
  pull-requests: write
